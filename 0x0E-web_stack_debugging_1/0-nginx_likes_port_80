#!/usr/bin/env bash
#Configures nginx to listen on port 80

# Check if running with sudo privileges
if [ "$(id -u)" != "0" ]; then
    echo "This script must be run with sudo privileges." >&2
    exit 1
fi

# Error handling function
handle_error() {
    echo "Error: $1" >&2
    exit 1
}

# Step 1: Install Nginx if not installed
if ! command -v nginx &> /dev/null; then
    echo "Step 1: Installing Nginx..."
    apt-get update || handle_error "Failed to update package repositories."
    apt-get install nginx -y || handle_error "Failed to install Nginx."
fi

# Step 2: Check and update Nginx configuration
nginx_conf="/etc/nginx/sites-available/default"
if ! grep -q "listen 80;" "$nginx_conf"; then
    echo "Step 2: Updating Nginx configuration..."
    sed -i 's/listen [::]:80 default_server;/listen 80 default_server;/' "$nginx_conf" || handle_error "Failed to update Nginx configuration."
fi

# Step 3: Restart Nginx to apply changes
echo "Step 3: Restarting Nginx..."
service nginx restart || handle_error "Failed to restart Nginx."

echo "Nginx is now listening on port 80."
